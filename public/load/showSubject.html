<div class="editingarea">
    <div class="c_flex"><span class="c_flexible"></span></div>
  <div class="c_editview">
   <div class="c_condition">
       <span><select><option>题干</option></select></span>
       <span class="pl5 " ><input type="text"></span>
       <span class="pl15 pr15 btn_gray ">查找</span>
       <span class="icon_lead-in"><em class="icon_r">批量导入题目</em></span>
       <span class="icon_add"><em class="icon_r">单个添加题目</em></span>
    </div>
    <div class="divtable">
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tablea">
            <tr hidden>
                <td align="center">年份</td>
                <td align="left">
                    <div class="chose chose1">
                      <a href="#" class="active3">全部</a>
                      <a href="#">语文</a>
                      <a href="#">数学</a>
                      <a href="#">英语</a>
                      <a href="#">政治</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>
       <div class="Catalog" >
           <div class="Catalog_right">
               <div class="Catalogtitle">总计<em>15552</em>道题&nbsp;&nbsp;提示：单击体面可显示答案和解析&nbsp;&nbsp;<input type="checkbox" /><b>显示答案和解析</b>&nbsp;&nbsp;<a href="#" class="Thispage">本页全部试题加入试卷</a><div><i>1</i><a href="#" class="pageone">前</a><a href="#" class="pagetwo">后</a></div></div>
               <div class="Catalog_rightnei" hidden>
                    <div class="Catalogtitwo">题号：25544&nbsp;&nbsp;题型：还是得&nbsp;&nbsp;难度：订餐&nbsp;&nbsp;上传人：女性司机&nbsp;&nbsp;来源：才能使得&nbsp;&nbsp;上传时间:220255&nbsp;&nbsp;组卷次数：<em>0</em></div>
                    <div class="Catalogcontent" >
                        <div class="Catalogcontentup">题型</div>
                        <div class="Catalogcontentdown"><a href="#"  value="通过">审核通过</a><a href="#" value="未通过">审核不通过</a><a href="#">删除题目</a></div>
                    </div>
               </div>
               
               <div class="Catalog_rightnei" hidden>
                    <div class="Catalogtitwo">题号：25544&nbsp;&nbsp;题型：还是得&nbsp;&nbsp;难度：订餐&nbsp;&nbsp;上传人：女性司机&nbsp;&nbsp;来源：才能使得&nbsp;&nbsp;上传时间:220255&nbsp;&nbsp;组卷次数：<em>0</em></div>
                    <div class="Catalogcontent">
                      <div class="Catalogcontentup">题型</div>
                      <div class="Catalogcontentdown"><a href="#">加入试卷</a></div>
                    </div>
               </div>
             
           </div>
           <div class="clear"></div>
       </div>
    </div>
</div>
<script type="text/javascript">
$(function(){
  $(".icon_add").on("click",function(){
    $('.right').load('./load/addSubject.html');
  })
  //types
  $.getJSON("/exam/manager/getAllSubjectType",function(data){
    //console.log(data);
    var tr1=$("tr:hidden").clone().removeAttr("hidden");
    //console.log(tr);
    // $("td:first-child").html("类型");
    tr1.children("td").eq(0).html("类型")
    tr1.find(".chose1").html("");
    data.forEach(function(item,index){
      //console.log(item);
      if(index==0){
        var a=$('<a href="javascript:void(0)" id="'+item.id+'" name='+item.name+' class="active3">'+item.realName+'</a>');
      }else{
        var a=$('<a href="javascript:void(0)" id="'+item.id+'" name='+item.name+'>'+item.realName+'</a>');
      }
      tr1.find(".chose1").append(a);
      tr1.find(".chose1").on("click","a",function(){
        $(this).addClass("active3").siblings().removeClass("active3");
      });
    });
    $(".tablea").append(tr1);
  });
    
  //levels
  $.getJSON("/exam/manager/getAllSubjectLevel",function(data){
    var tr1=$("tr:hidden").clone().removeAttr("hidden");
    tr1.children("td").eq(0).html("难易程度")
    tr1.find(".chose1").html("");
    data.forEach(function(item,index){
      //console.log(item);
      if(index==0){
        var a=$('<a href="javascript:void(0)" id="'+item.id+'" name='+item.name+' class="active3">'+item.realName+'</a>');
      }else{
         var a=$('<a href="javascript:void(0)" id="'+item.id+'" name='+item.name+' >'+item.realName+'</a>');
      }
      tr1.find(".chose1").append(a);
      tr1.find(".chose1").on("click","a",function(){
        $(this).addClass("active3").siblings().removeClass("active3");
      });
    });
    $(".tablea").append(tr1);
  });

  //departments
  $.getJSON("/exam/manager/getAllDepartmentes",function(data){
    var tr1=$("tr:hidden").clone().removeAttr("hidden");
    tr1.children("td").eq(0).html("方向")
    tr1.find(".chose1").html("");
    data.forEach(function(item,index){
      if(index==0){
        var a=$('<a href="javascript:void(0)" id="'+item.id+'" name='+item.name+' class="active3">'+item.name+'</a>');
      }else{
         var a=$('<a href="javascript:void(0)" id="'+item.id+'" name='+item.name+'>'+item.name+'</a>');
      }
      tr1.find(".chose1").append(a);
      tr1.find(".chose1").on("click","a",function(){
        $(this).addClass("active3").siblings().removeClass("active3");
      });

    });
    $(".tablea").append(tr1);
  });

  //topics和展示数据
  $.getJSON("/exam/manager/getAllTopics",function(data){
    tr1=$("tr:hidden").clone().removeAttr("hidden");
    tr1.children("td").eq(0).html("知识点")
    tr1.find(".chose1").html("");
    data.forEach(function(item,index){
      if(index==0){
        var a=$('<a href="javascript:void(0)" id="'+item.id+'" class="active3">'+item.title+'</a>');
      }else{
         var a=$('<a href="javascript:void(0)" id="'+item.id+'">'+item.title+'</a>');
      }
      tr1.find(".chose1").append(a);
      tr1.find(".chose1").on("click","a",function(){
        $(this).addClass("active3").siblings().removeClass("active3");
      });
    });
    $(".tablea").append(tr1);


      var department='';
      var level='';
      var type='';
      var topic='';
      
   //展示题目
    $('.tablea').on('click','a',function(){
      var arr=$("table").find("a").filter(":visible").map(function(index,item){
        if($(item).hasClass("active3")){
          //console.log(item);
          return item;
        }
      }).get();
      //console.log(arr);
      arr.forEach(function(item,index){
        switch(index){
          case 0:type=$(item).attr("id");
            break;
          case 1:level=$(item).attr("id");
            break;
          case 2:department=$(item).attr("id");
            break;
          case 3:topic=$(item).attr("id");
            break;
        }
        //console.log(department,level,type,topic);
      });
      
      //展示题干
      $.ajax('/exam/manager/querySubject',{
        method:"post",
        data:{
          "department_id":department,
          "subjectlevel_id":level,
          "subjectType_id":type,          
          "topic_id":topic,
        },
        success:function(data){
            //console.log(data);
            showData(data);
            //审核通过
             $(".Catalogcontentdown").children("a").on("click",function(){ 
              console.log(this);
              var elment=$(this).parent();
              var checkState=$(this).attr("value");
              var id=$(".Catalogcontentup").children("span").attr("id");
             $.ajax('/exam/manager/checkSubject',{
                    method:"post",
                    data:{
                      "id":id,
                      "checkState":checkState
                    },
                    success:function(data){
                      //console.log(data);
                      elment.parent().parent().empty();
                    }
              });
           });
           
        }
      })
    });
  });
  
  var div;
//展示题目的方法
  function showData(data){
    $(".Catalogtitle").find("em").html(data.length);
    $(".Catalog_rightnei:not(:hidden)").remove();
    //console.log(data);
    data.forEach(function(item,index){
      //console.log(item);
      div=$(".Catalog_rightnei:hidden").clone().removeAttr("hidden");
      var id=item.id;
      stemOne="<span id="+id+">"+item.stem+"</span><br>";
      div.find(".Catalogcontentup").on("click",function(){
        div.find(".Catalogcontentup").off("click");
        if(item.subjectType_id==1||item.subjectType_id==2){
          //展示选择题选项
          $.ajax('/exam/manager/choiceSubject',{
              method:"post",
              data:{
                "subject_id":id
              },
              success:function(data){
                choices(data);
              }
          });
        }else{
          
        }
      })
      div.find(".Catalogcontentup").append(stemOne);
      $(".Catalog_right").append(div);
    });
  }

  function choices(data){
    //console.log(data);[]
    data.forEach(function(item,index){
      console.log(item);
      
      //console.log(item.correct);
      var id=item.id;
      //console.log(id);
      var correct=item.correct;
      switch(id){
        case 1:
          correct===1?stemTwo="<span style='color:red'>A</span>":stemTwo="<span>A</span>";
          correct===1?stemThree="<span id="+id+" style='color:red'>."+item.content+"</span><br>":stemThree="<span id="+id+" >."+item.content+"</span><br>";
          break;
        case 2:
          correct===1?stemTwo="<span style='color:red'>B</span>":stemTwo="<span>B</span>";
          correct===1?stemThree="<span id="+id+" style='color:red'>."+item.content+"</span><br>":stemThree="<span id="+id+" >."+item.content+"</span><br>";
          break;
        case 3:
          correct===1?stemTwo="<span style='color:red'>C</span>":stemTwo="<span>C</span>";
          correct===1?stemThree="<span id="+id+" style='color:red'>."+item.content+"</span><br>":stemThree="<span id="+id+" >."+item.content+"</span><br>";
          break;
        case 4:
          correct===1?stemTwo="<span style='color:red'>D</span>":stemTwo="<span>D</span>";
          correct===1?stemThree="<span id="+id+" style='color:red'>."+item.content+"</span><br>":stemThree="<span id="+id+" >."+item.content+"</span><br>";
          break;
      }
      
       div.find(".Catalogcontentup").append(stemTwo,stemThree);
    })
  }

});



</script>

<style type="text/css">
  td.center{
    text-align: center;
  }
</style>>